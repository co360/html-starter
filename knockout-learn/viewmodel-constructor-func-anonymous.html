<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KnockoutJS Starter</title>
    <script src="../resources/js/libs/knockout/knockout-3.5.0.debug.js"></script>
</head>
<body>

<div id="app">
    <h1>DEMO1</h1>
    <div>upCase: <span data-bind="text: upCase('foo')"></span></div>
    <div>Message: <span data-bind="text: message"></span></div>
    <div>upCaseMessage: <span data-bind="text: upCaseMessage()"></span></div>
    <div>Link: <a href="#" data-bind="click: handleEvent">Test</a></div>
    <div>Button: <button data-bind="click: handleEvent">Test</button></div>
    <div>myList:
        <ul data-bind="foreach: myList">
            <li>
                <span data-bind="text: $data.name"></span>
                <a href="#" data-bind="click: $parent.handleEventByLoop">Test</a>
            </li>
        </ul>
    </div>
</div>

<div id="app2">
    <h1>DEMO2</h1>
    <span data-bind="text: dataListLength"></span>
</div>

<script>
    // NOTE: Do not forget to use "new" on this anonymous constructor function,
    // or else your $parent will be "undefined" but other parts still works.
    // This will lead to very hard to debug problem!
    var vm = new function() {
        var self = this;
        this.message = ko.observable("Hello");
        this.myList = [{name: 'zemian'}, {name: 'kenny'}, {name: 'lily'}];
        
        self.upCase = function(str) {
            return str.toUpperCase();
        };
        self.upCaseMessage = function() {
            return self.upCase(this.message());
        };
        
        self.handleEvent = function(data, event) {
            // "this"" is same as data, which is the ViewModelContext
            console.log("this, data, event, message ", this, data, event, self.message());
        };
        
        self.handleEventByLoop = function(data, event) {
            console.log("this, data, event, message", this, data, event, self.message());
        }
    }();
    ko.applyBindings(vm, document.getElementById("app"));
    
    // == TEST
    var o4 = {
        foo: "one",
        bar: (() => {console.log("bar this", this); return "bar BIG " + this.foo; })(),
        baz: (() => {console.log("baz this", this); return "baz BIG " + this.foo; })(),
        foobar: "foobar",
    };
    console.log("o4", o4); // { foo: 'one', bar: 'BIG one' }
    console.log("o4.bar", o4.bar); // BIG one
    console.log("o4.baz", o4.baz); // BIG2 undefined !!! ???
    console.log("o4.foobar", o4.foobar); // foobar

    // // == VM Model #2 demo
    // var vm2 = {
    //     dataList: ko.observableArray([1, 2, 3]),
    //     dataListLength: (() => this.dataList().length)()
    // };
    // ko.applyBindings(vm2, document.getElementById("app2"));
</script>

</body>
</html>
