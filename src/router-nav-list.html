<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OJET Starter</title>
    <link rel="icon" href="css/images/favicon.ico" type="image/x-icon"/>
    <link rel="stylesheet" href="css/alta/6.2.0/web/alta.css"/>

    <script type="text/javascript" src="js/libs/require/require.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script>
        require(['ojs/ojcore', 'knockout', 'jquery', 'ojs/ojknockout',
                'ojs/ojmodule', 'ojs/ojrouter', 'ojs/ojnavigationlist',
                'ojs/ojjsontreedatasource', 'text'
            ],
            function (oj, ko, $) {

                // Change default URL adapter
                oj.Router.defaults['urlAdapter'] = new oj.Router.urlParamAdapter();

                // Change the default location for the viewModel and view files
                oj.ModuleBinding.defaults.modelPath = 'viewModels/router-nav-list/';
                oj.ModuleBinding.defaults.viewPath = 'text!views/router-nav-list/';

                // Build Navigation List model using the states of the router hierarchy
                function buildNavListData(router, parentId) {
                    var jsonData = [];

                    router.states.forEach(function (state) {
                        var hrefurl, childrenData = [];

                        if (state.value instanceof oj.Router) {
                            childrenData = buildNavListData(state.value, state.id);
                        }

                        if (parentId) {
                            hrefurl = "?root=" + parentId + "&" + router.name + "=" + state.id;
                        } else {
                            hrefurl = "?root=" + state.id;
                        }

                        jsonData.push(
                            {
                                'attr':
                                    {
                                        // The id is the compound state to transition to this state
                                        id: parentId ? parentId + '/' + state.id : state.id,
                                        label: state.label,
                                        href: hrefurl
                                    },
                                'children': childrenData
                            });
                    });

                    return jsonData;
                }

                // Retrieve the router static instance and configure the states
                var router = oj.Router.rootInstance;
                // Each state value property is a transfer object
                router.configure(
                    {
                        'home':
                            {
                                label: 'Home',
                                isDefault: true
                            },
                        'book':
                            {
                                label: 'Book',
                                value: router.createChildRouter('chapter', 'book').configure(
                                    {
                                        'preface': {label: 'Preface'},
                                        'chapter1': {label: 'Chapter 1'},
                                        'chapter2': {label: 'Chapter 2'},
                                        'chapter3': {label: 'Chapter 3'}
                                    })
                            },
                        'table':
                            {
                                label: 'Table',
                                value: router.createChildRouter('tables', 'table').configure(
                                    {
                                        'dept': {label: 'Department'},
                                        'emp': {label: 'Employee'}
                                    })
                            }
                    });
                /**
                 * The view model
                 */
                var viewModel =
                    {
                        router: router,

                        // The list of items
                        navListData: new oj.JsonTreeDataSource(buildNavListData(router)),

                        // Navigation List Event handler
                        selectHandler: function (event) {
                            if ('menu' === event.target.id && event.detail.originalEvent) {
                                // router takes care of changing the selection
                                event.preventDefault();
                                // Invoke go() with the selected item.
                                viewModel.router.go(event.detail.key);
                            }
                        }
                    };

                // A computed observable representing the currently selected item in the list
                viewModel.selection = ko.computed(function () {
                    var currentState = this.currentState(),
                        childRouter, selection, data;

                    if (currentState && currentState.id) {
                        childRouter = currentState.value;
                        if (childRouter) {
                            selection = childRouter.stateId();
                        }

                        if (selection) {
                            selection = currentState.id + '/' + selection;
                        } else {
                            selection = currentState.id;
                        }
                    }

                    return selection;
                }, router);

                $(function () {
                    oj.Router.sync().then(function () {
                        ko.applyBindings(viewModel, document.getElementById('routing-container'));
                    });
                });
            });
    </script>
</head>
<body>

<div id="sampleDemo" style="" class="demo-padding demo-container">
    <div id="componentDemoContent" style="width: 1px; min-width: 100%;">

        <div id="routing-container">
            <div id="navlist" class="oj-flex oj-flex-items-pad">
                <div class="oj-xl-3 oj-lg-3 oj-md-3 oj-sm-12 oj-flex-item">
                    <oj-navigation-list id="menu" class="oj-navigationlist-nofollow-link"
                                        data="[[navListData]]"
                                        drill-mode="collapsible"
                                        selection="[[selection]]"
                                        on-oj-before-select="[[selectHandler]]"
                                        item.renderer="[[oj.KnockoutTemplateUtils.getRenderer('item_template', true)]]">
                    </oj-navigation-list>
                </div>
                <div class="oj-xl-9 oj-lg-9 oj-md-9 oj-sm-12 oj-flex-item" data-bind="if: router.stateId() ">
                    <!-- This is where the module content will be loaded -->
                    <div id="content" data-bind="ojModule: router.moduleConfig"></div>
                </div>
            </div>
        </div>

        <script type="text/html" id="item_template">
            <li data-bind="attr:{ id : $data['id']}">
                <a data-bind="text: $data['label'], attr:{href:$data['href']}"></a>
            </li>
        </script>


    </div>
</div>

</body>
</html>
